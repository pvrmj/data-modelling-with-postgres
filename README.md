# Udacity Data Engineering Nanodegree Program
## Project 1: Data Modelling with Postgres

### Project Summary
This project, as part of the *Udacity Data Engineering Nanodegree Program*, is aimed at creating a postgres database `sparkifydb` for a startup called Sparkify. They want to analyze the data they've been collecting on songs and user activity on their new music streaming app. The analytics team is particularly interested in understanding what songs users are listening to. Currently, they don't have an easy way to query their data, which resides in a directory of JSON logs on user activity on the app, as well as a directory with JSON metadata on the songs in their app.
This project creates a database schema and ETL pipeline for Sparkify. It is setup as a PostgreSQL relational database following a star schema, with the scripts being written in Python.

### Datasets
#### Song dataset
The first dataset is a subset of real data from the Million Song Dataset. Each file is in JSON format and contains metadata about a song and the artist of that song. The files are partitioned by the first three letters of each song's track ID. For example, here are filepaths to two files in this dataset.

> song_data/A/B/C/TRABCEI128F424C983.json
> song_data/A/A/B/TRAABJL12903CDCF1A.json

And below is an example of what a single song file, TRAABJL12903CDCF1A.json, looks like.

> {"num_songs": 1, "artist_id": "ARJIE2Y1187B994AB7", "artist_latitude": null, "artist_longitude": null, "artist_location": "", "artist_name": "Line Renaud", "song_id": "SOUPIRU12A6D4FA1E1", "title": "Der Kleine Dompfaff", "duration": 152.92036, "year": 0}

#### Log dataset
The second dataset consists of log files in JSON format generated by this event simulator based on the songs in the dataset above. These simulate activity logs from a music streaming app based on specified configurations.

The log files in the dataset you'll be working with are partitioned by year and month. For example, here are filepaths to two files in this dataset.

> log_data/2018/11/2018-11-12-events.json
> log_data/2018/11/2018-11-13-events.json

To read the files, a pandas dataframe needs to be created.

### Files
In addition to the data files, the project workspace includes six files:

- `test.ipynb` can be used for testing and displays the first few rows of each table to check the database.
- `create_tables.py` drops and creates the tables.
- `etl.ipynb` reads and processes a single file from song_data and log_data and loads the data into the tables. 
- `etl.py` reads and processes files from song_data and log_data and loads them into the tables. This file is filled out based on the ETL notebook, `etl.ipynb`.
- `sql_queries.py` contains all sql queries, and is imported into the last three files above.

### Database Schema and justification
In `sql_queries.py`, DROP, CREATE and INSERT queries are defined. These are read from `create_tables.py`.

The databases star schema consists of 1 fact table (`songplays`) and 4 dimension tables (`users`, `songs`, `artists` and `time`).

![Schema](https://github.com/pvrmj/data-modelling-with-postgres/blob/main/Db_diagram.jpeg)

- songplays - records in log data associated with song plays
`songplay_id, start_time, user_id, level, song_id, artist_id, session_id, location, user_agent`

- users - users in the app
`user_id, first_name, last_name, gender, level`
- songs - songs in music database
`song_id, title, artist_id, year, duration`
- artists - artists in music database
`artist_id, name, location, latitude, longitude`
- time - timestamps of records in songplays broken down into specific units
`start_time, hour, day, week, month, year, weekday`

### Extract, transform, load (ETL)
As stated above, `etl.py` reads and processes the files from song_data and log_data and loads them into the tables

### Running the scripts
To run the project in the Udacity *Project Workspace*, open a new terminal window and enter

> python create_tables.py
> python etl.py

### Example queries
`test.ipynb` already gives a few test queries that can be run.

Other examples to perform analyses on the data may include:

Select all artists whose name start with 'A'
`SELECT * FROM artists WHERE name LIKE 'A%'`

artist_id	name	location	latitude	longitude
AR7G5I41187FB4CE6C	Adam Ant	London, England	NaN	NaN
ARL7K851187B99ACD2	Andy Andy		NaN	NaN
ARI3BMM1187FB4255E	Alice Stuart	Washington	38.8991	-77.029


Select all artists whose name contains 'The'
`SELECT * FROM artists WHERE name LIKE '%The%'`

artist_id	name	location	latitude	longitude
ARMJAGH1187FB546F3	The Box Tops	Memphis, TN	35.14968	-90.04892
ARMAC4T1187FB3FA4C	The Dillinger Escape Plan	Morris Plains, NJ	40.82624	-74.47995
ARAJPHH1187FB5566A	The Shangri-Las	Queens, NY	40.7038	-73.83168


Select all artists whose name does NOT contain 'The'
`SELECT * FROM artists WHERE name NOT LIKE ('%The%') LIMIT 10`

artist_id	name	location	latitude	longitude
ARD7TVE1187B99BFB1	Casual	California - LA	NaN	NaN
ARNTLGG11E2835DDB9	Clp		NaN	NaN
AR8ZCNI1187B9A069B	Planet P Project		NaN	NaN
AR10USD1187B99F3F1	Tweeterfriendly Music	Burlington, Ontario, Canada	NaN	NaN
ARKFYS91187B98E58F	Jeff And Sheri Easter		NaN	NaN
ARD0S291187B9B7BF5	Rated R	Ohio	NaN	NaN
ARGSJW91187B9B1D6B	JennyAnyKind	North Carolina	35.21962	-80.01955
AR7G5I41187FB4CE6C	Adam Ant	London, England	NaN	NaN
ARXR32B1187FB57099	Gob		NaN	NaN
ARKRRTF1187B9984DA	Sonora Santanera		NaN	NaN




